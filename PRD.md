# MVP-W é¡¹ç›®æŠ€æœ¯æ¶æ„æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

**MVP-W (Minimum Viable Product - Watcher)** æ˜¯ä¸€ä¸ªè¾¹ç¼˜è®¾å¤‡ + äº‘ç«¯å¤§è„‘çš„æœ€å°å¯è¡Œç‰ˆæœ¬ã€‚

### æ ¸å¿ƒç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ESP32-S3 (ä¸»æ§)  â”‚      â”‚    PC äº‘ç«¯         â”‚
â”‚   (Watcher è®¾å¤‡)   â”‚â—„â”€â”€â”€â”€â–ºâ”‚    (å¤§è„‘)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - éŸ³è§†é¢‘é‡‡é›†        â”‚      â”‚ - LLM åˆ†æ          â”‚
â”‚ - å±å¹•æ˜¾ç¤º/è¡¨æƒ…     â”‚      â”‚ - ASR è¯­éŸ³è¯†åˆ«      â”‚
â”‚ - æŒ‰é”®è¯­éŸ³è§¦å‘      â”‚      â”‚ - TTS è¯­éŸ³åˆæˆ      â”‚
â”‚ - UART â†’ ESP32-MCUâ”‚      â”‚ - Agent æ„å›¾ç†è§£    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ UART
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32 (èº«ä½“/MCU)  â”‚
â”‚  (èˆµæœºæ§åˆ¶)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - èˆµæœº X/Y è½´      â”‚
â”‚ - LED çŠ¶æ€æŒ‡ç¤º      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠŸèƒ½è¾¹ç•Œ

| åŠŸèƒ½ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| **è¯­éŸ³é‡‡é›†** | ESP32-S3 | I2S éº¦å…‹é£ â†’ Opus ç¼–ç  â†’ WebSocket |
| **è¯­éŸ³æ’­æ”¾** | ESP32-S3 | WebSocket â† Opus è§£ç  â†’ I2S å–‡å­ |
| **è§†é¢‘é‡‡é›†** | ESP32-S3 | Himax æ‘„åƒå¤´ â†’ JPEG â†’ WebSocket |
| **å±å¹•æ˜¾ç¤º** | ESP32-S3 | LVGL UI + è¡¨æƒ…æ˜¾ç¤º |
| **æŒ‰é”®è§¦å‘** | ESP32-S3 | é•¿æŒ‰å¼€å§‹/ç»“æŸè¯­éŸ³è¾“å…¥ |
| **è¿åŠ¨æ§åˆ¶** | ESP32-MCU | GPIO PWM â†’ èˆµæœºäº‘å° |
| **LLM/Agent** | PC äº‘ç«¯ | Claude API / æœ¬åœ° LLM |
| **ASR/STT** | PC äº‘ç«¯ | è¯­éŸ³è½¬æ–‡å­— |
| **TTS** | PC äº‘ç«¯ | æ–‡å­—è½¬è¯­éŸ³ |

### æŠ€æœ¯å‚è€ƒ

- **ESP32-S3 SDK**: ä½¿ç”¨ Watcher-Firmware å®˜æ–¹ SDK (`sensecap-watcher`)
- **ESP32-MCU**: å‚è€ƒ WatcherOld/MCU æ¶æ„ (`main.c`)
- **ç¡¬ä»¶å‚æ•°**: å‚è€ƒ `Watcher-Firmware/examples/helloworld/local_components/sensecap-watcher/include/sensecap-watcher.h`

---

## ä¸€ã€ç¡¬ä»¶æ¶æ„

### 1.1 ç³»ç»Ÿæ¡†å›¾ (åŒESP32æ¶æ„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MVP-W ç³»ç»Ÿæ¶æ„                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚    ESP32-S3 (ä¸»æ§)       â”‚ WiFi â”‚      PC äº‘ç«¯ (Python)     â”‚   â”‚
â”‚   â”‚    (Watcher è®¾å¤‡)         â”‚â—„â”€â”€â”€â”€â–ºâ”‚                            â”‚   â”‚
â”‚   â”‚                          â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  â”‚   WebSocket Server    â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  éŸ³é¢‘ Pipeline    â”‚ â”‚ åŒå‘æµâ”‚  â”‚   - éŸ³é¢‘æµæ¥æ”¶/å‘é€  â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  - I2S éº¦å…‹é£    â”‚ â”‚      â”‚  â”‚   - è§†é¢‘æµæ¥æ”¶        â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  - Opus ç¼–ç      â”‚ â”‚      â”‚  â”‚   - æ§åˆ¶æŒ‡ä»¤ä¸‹å‘      â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  - Opus è§£ç      â”‚ â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚  â”‚  - I2S å–‡å­     â”‚ â”‚      â”‚              â”‚                â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚              â–¼                â”‚   â”‚
â”‚   â”‚                          â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  â”‚   ASR (STT)           â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  Himax æ‘„åƒå¤´     â”‚ â”‚ â”€â”€â–º  â”‚  â”‚   è¯­éŸ³è¯†åˆ«             â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  (SPI)            â”‚ â”‚ JPEG â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚              â”‚                â”‚   â”‚
â”‚   â”‚                          â”‚      â”‚              â–¼                â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”‚  LVGL å±å¹•        â”‚ â”‚ â—„â”€â”€  â”‚  â”‚   LLM + Agent         â”‚ â”‚   â”‚
â”‚   â”‚  â”‚  412x412 + è¡¨æƒ…   â”‚ â”‚ æ˜¾ç¤º â”‚  â”‚   æ„å›¾ç†è§£ + å†³ç­–     â”‚ â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                          â”‚      â”‚              â”‚                â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚              â–¼                â”‚   â”‚
â”‚   â”‚  â”‚  æŒ‰é”®è§¦å‘         â”‚ â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”‚  GPIO æ—‹é’®/æŒ‰é’®   â”‚ â”‚      â”‚  â”‚   TTS                  â”‚ â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚  â”‚   è¯­éŸ³åˆæˆ             â”‚ â”‚   â”‚
â”‚   â”‚                          â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”‚  â”‚  UART è½¬å‘        â”‚ â”‚                                        â”‚
â”‚   â”‚  â”‚  GPIO 43/44      â”‚ â”‚  â—„â”€â”€ è½¬å‘æ§åˆ¶æŒ‡ä»¤                    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚               â”‚ UART 115200                                        â”‚
â”‚               â”‚ (äº¤å‰è¿æ¥ TXâ†”RX)                                   â”‚
â”‚               â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚   â”‚   ESP32 (èº«ä½“/MCU)       â”‚  â† å‚è€ƒ WatcherOld/MCU æ¶æ„      â”‚
â”‚   â”‚                          â”‚                                    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚   â”‚  â”‚  UART æ¥æ”¶        â”‚ â”‚  â† æ¥æ”¶ä¸»æ§æŒ‡ä»¤                    â”‚
â”‚   â”‚  â”‚  GPIO 16/17       â”‚ â”‚                                    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚   â”‚           â”‚            â”‚                                    â”‚
â”‚   â”‚           â–¼            â”‚                                    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚   â”‚  â”‚  èˆµæœºæ§åˆ¶         â”‚ â”‚  â† X/Y è½´ PWM                    â”‚
â”‚   â”‚  â”‚  - GPIO 12 (X)   â”‚ â”‚                                    â”‚
â”‚   â”‚  â”‚  - GPIO 13 (Y)   â”‚ â”‚  â† å‚è€ƒ WatcherOld/MCU/main.c     â”‚
â”‚   â”‚  â”‚  LEDC PWM 50Hz   â”‚ â”‚                                    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚   â”‚                          â”‚                                    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚
â”‚   â”‚  â”‚  LED çŠ¶æ€æŒ‡ç¤º     â”‚ â”‚                                    â”‚
â”‚   â”‚  â”‚  GPIO 2           â”‚ â”‚                                    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ESP32-S3 (ä¸»æ§) GPIO åˆ†é…

> **å‚è€ƒ**: `Watcher-Firmware/examples/helloworld/local_components/sensecap-watcher/include/sensecap-watcher.h`

| GPIO | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| GPIO 10 | I2S MCLK | éŸ³é¢‘æ—¶é’Ÿ |
| GPIO 11 | I2S BCLK | ä½æ—¶é’Ÿ |
| GPIO 12 | I2S LRCK | å·¦å³å£°é“ |
| GPIO 15 | I2S DOUT | å–‡å­è¾“å‡º |
| GPIO 16 | I2S DIN | éº¦å…‹é£è¾“å…¥ |
| GPIO 4,5,6 | LCD SPI | æ˜¾ç¤ºå™¨ |
| GPIO 21 | Himax CS | æ‘„åƒå¤´ |
| GPIO 38,39 | Touch I2C | è§¦æ‘¸å± |
| GPIO 41,42 | æ—‹é’® Encoder | æŒ‰é’®è¾“å…¥ |
| GPIO 43 | UART TX | â†’ ESP32-MCU RX |
| GPIO 44 | UART RX | â† ESP32-MCU TX |

### 1.3 ESP32 (èº«ä½“/MCU) GPIO åˆ†é…

> **å‚è€ƒ**: `WatcherOld/MCU/main/main.c`

| GPIO | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| GPIO 16 | UART RX | æ¥æ”¶ä¸»æ§æŒ‡ä»¤ |
| GPIO 17 | UART TX | å‘é€å“åº” |
| GPIO 12 | èˆµæœº X è½´ | PWM è¾“å‡º |
| GPIO 13 | èˆµæœº Y è½´ | PWM è¾“å‡º |
| GPIO 2 | LED çŠ¶æ€ | æŒ‡ç¤ºç¯ |

### 1.4 é€šä¿¡æ¥å£

```
PC (Server)              ESP32-S3 (ä¸»æ§)          ESP32-MCU
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
:8766 (WS)  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º è¿æ¥å»ºç«‹

æ§åˆ¶æŒ‡ä»¤ (PC â†’ S3 â†’ MCU):
{"type": "servo", "x": 90, "y": 45}  â”€â”€â”€â”€â”€â”€â–º  X:90\r\nY:45\r\n

TTS æ’­æ”¾ (PC â†’ S3):
{"type": "tts", "text": "ä½ å¥½"}  â”€â”€â–º éŸ³é¢‘æ’­æ”¾

å±å¹•æ˜¾ç¤º (PC â†’ S3):
{"type": "display", "text": "ä½ å¥½", "emoji": "happy"}

åª’ä½“æµ:
Opus Audio â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Opus Audio
JPEG Image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º JPEG Image
```

---

## äºŒã€è½¯ä»¶æ¶æ„

### 2.1 ESP32-S3 (ä¸»æ§) æ¶æ„

> åŸºäº Watcher-Firmware å®˜æ–¹ SDK

```
ESP32-S3 Firmware (MVP-W)
â”‚
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ app_main.c              # å…¥å£ + ç³»ç»Ÿåˆå§‹åŒ–
â”‚   â”œâ”€â”€ ws_client.c             # WebSocket å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ audio_pipeline.c        # éŸ³é¢‘ pipeline
â”‚   â”‚   â”œâ”€â”€ i2s_capture_init() # éº¦å…‹é£åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ opus_encode()       # Opus ç¼–ç 
â”‚   â”‚   â”œâ”€â”€ opus_decode()       # Opus è§£ç 
â”‚   â”‚   â””â”€â”€ i2s_play_init()     # å–‡å­åˆå§‹åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ button_voice.c          # æŒ‰é”®è¯­éŸ³è§¦å‘
â”‚   â”‚   â”œâ”€â”€ bsp_knob_btn_init() # æ—‹é’®æŒ‰é’®åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ long_press_start()  # é•¿æŒ‰å¼€å§‹å½•éŸ³
â”‚   â”‚   â””â”€â”€ long_release_stop()  # é•¿æŒ‰ç»“æŸå½•éŸ³
â”‚   â”‚
â”‚   â”œâ”€â”€ display_ui.c            # LVGL å±å¹•æ˜¾ç¤º
â”‚   â”‚   â”œâ”€â”€ bsp_lvgl_init()    # LVGL åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ show_text()        # æ˜¾ç¤ºæ–‡å­—
â”‚   â”‚   â””â”€â”€ show_emoji()        # æ˜¾ç¤ºè¡¨æƒ…
â”‚   â”‚
â”‚   â”œâ”€â”€ camera_capture.c        # Himax æ‹ç…§
â”‚   â”‚   â””â”€â”€ sscma_client_sample() # å›¾åƒé‡‡é›†
â”‚   â”‚
â”‚   â””â”€â”€ uart_bridge.c          # UART è½¬å‘åˆ° MCU
â”‚       â”œâ”€â”€ uart_init()        # UART åˆå§‹åŒ–
â”‚       â””â”€â”€ uart_forward()      # è½¬å‘æŒ‡ä»¤åˆ° MCU
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ sensecap-watcher        # ç¡¬ä»¶æŠ½è±¡ (å®˜æ–¹SDK)
â”‚   â”‚   â”œâ”€â”€ bsp_audio_init()  # éŸ³é¢‘åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ bsp_lvgl_init()   # LVGL åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ bsp_knob_btn_init() # æŒ‰é’®åˆå§‹åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ sscma_client          # Himax é€šä¿¡
â”‚   â””â”€â”€ opus                   # Opus ç¼–è§£ç 
â”‚
â””â”€â”€ CMakeLists.txt
```

### 2.2 ESP32-MCU (èº«ä½“) æ¶æ„

> å‚è€ƒ WatcherOld/MCU æ¶æ„

```
ESP32-MCU Firmware
â”‚
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ main.c                 # å…¥å£ + æ ¸å¿ƒé€»è¾‘
â”‚   â”‚
â”‚   â”œâ”€â”€ uart_handler.c         # UART æŒ‡ä»¤å¤„ç†
â”‚   â”‚   â”œâ”€â”€ uart_init()       # UART2 åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ process_cmd()      # æŒ‡ä»¤è§£æ
â”‚   â”‚
â”‚   â”œâ”€â”€ servo_control.c        # èˆµæœºæ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ ledc_init()       # LEDC åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ set_angle()       # è®¾ç½®è§’åº¦
â”‚   â”‚   â””â”€â”€ smooth_move()     # å¹³æ»‘ç§»åŠ¨
â”‚   â”‚
â”‚   â””â”€â”€ bt_state.c            # çŠ¶æ€æŒ‡ç¤º
â”‚
â””â”€â”€ CMakeLists.txt
```

### 2.3 æŒ‰é”®è¯­éŸ³è§¦å‘æµç¨‹

> ä½¿ç”¨ Watcher-Firmware å®˜æ–¹ SDK ä¸­çš„æ—‹é’®æŒ‰é’®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŒ‰é”®è¯­éŸ³è§¦å‘æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. ç”¨æˆ·é•¿æŒ‰æ—‹é’®æŒ‰é’®                                         â”‚
â”‚     â””â”€â”€ bsp_knob_btn_init() â†’ æŒ‰é’®ä¸­æ–­                     â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  2. å¼€å§‹å½•éŸ³                                                 â”‚
â”‚     â””â”€â”€ bsp_i2s_read() â†’ PCM æ•°æ®                           â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  3. å®æ—¶ Opus ç¼–ç  â†’ WebSocket å‘é€                        â”‚
â”‚     â””â”€â”€ opus_encode() â†’ ws_send(audio)                       â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  4. ç”¨æˆ·æ¾å¼€æŒ‰é’®                                             â”‚
â”‚     â””â”€â”€ button_release äº‹ä»¶                                  â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  5. ç»“æŸå½•éŸ³ â†’ å‘é€ç»“æŸæ ‡è®°                                 â”‚
â”‚     â””â”€â”€ ws_send({type: "audio_end"})                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 å±å¹•æ˜¾ç¤ºä¸è¡¨æƒ…

> ä½¿ç”¨ Watcher-Firmware å®˜æ–¹ SDK ä¸­çš„ LVGL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å±å¹•æ˜¾ç¤ºæµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  äº‘ç«¯å›å¤:                                                   â”‚
â”‚  {                                                          â”‚
â”‚    "type": "display",                                       â”‚
â”‚    "text": "ä½ å¥½å‘€!",                                       â”‚
â”‚    "emoji": "happy"                                         â”‚
â”‚  }                                                          â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  LVGL æ˜¾ç¤º                           â”‚                   â”‚
â”‚  â”‚  - æ˜¾ç¤ºæ–‡å­— (lv_label_set_text)      â”‚                   â”‚
â”‚  â”‚  - æ˜¾ç¤ºè¡¨æƒ…å›¾æ ‡ (lv_img)             â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â”‚  æ”¯æŒçš„è¡¨æƒ…:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  happy â”‚  sad  â”‚ surprisedâ”‚ angry â”‚  normal â”‚          â”‚
â”‚  â”‚   ğŸ˜Š   â”‚   ğŸ˜¢   â”‚    ğŸ˜²    â”‚   ğŸ˜    â”‚   ğŸ˜    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 PC äº‘ç«¯æ¶æ„

```
PC Backend (MVP-W-Server)
â”‚
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ websocket_server.py   # WebSocket æœåŠ¡
â”‚   â”œâ”€â”€ audio_handler.py      # éŸ³é¢‘æµå¤„ç†
â”‚   â”œâ”€â”€ video_handler.py      # è§†é¢‘æµå¤„ç†
â”‚   â””â”€â”€ control_handler.py   # æ§åˆ¶æŒ‡ä»¤
â”‚
â”œâ”€â”€ ai/
â”‚   â”œâ”€â”€ asr.py               # è¯­éŸ³è¯†åˆ« (å¯é€‰)
â”‚   â”œâ”€â”€ llm.py               # LLM æ¥å£
â”‚   â”œâ”€â”€ agent.py             # Agent é€»è¾‘
â”‚   â””â”€â”€ tts.py               # TTS æ¥å£
â”‚
â”œâ”€â”€ config.py                  # é…ç½®
â””â”€â”€ main.py                   # å…¥å£
```

---

## ä¸‰ã€é€šä¿¡åè®®

### 3.1 WebSocket æ¶ˆæ¯æ ¼å¼

#### 3.1.1 æ¶ˆæ¯ç±»å‹

```python
# æ¶ˆæ¯ç±»å‹æšä¸¾
class MessageType:
    # æ§åˆ¶æŒ‡ä»¤ (PC -> ESP32)
    SERVO_CONTROL = "servo"        # èˆµæœºæ§åˆ¶
    TTS_PLAY = "tts"              # è¯­éŸ³æ’­æ”¾
    DISPLAY_TEXT = "display"       # æ˜¾ç¤ºæ–‡å­—
    DISPLAY_IMAGE = "display_image" # æ˜¾ç¤ºå›¾åƒ
    GET_SENSOR = "get_sensor"     # è·å–ä¼ æ„Ÿå™¨
    REBOOT = "reboot"             # é‡å¯

    # åª’ä½“æµ (ESP32 -> PC)
    AUDIO_STREAM = "audio"        # éŸ³é¢‘æµ
    VIDEO_STREAM = "video"        # è§†é¢‘æµ
    SENSOR_DATA = "sensor"         # ä¼ æ„Ÿå™¨æ•°æ®

    # çŠ¶æ€æ¶ˆæ¯ (åŒå‘)
    CONNECTED = "connected"
    ERROR = "error"
    PING = "ping"
    PONG = "pong"
```

#### 3.1.2 æ§åˆ¶æŒ‡ä»¤ (PC â†’ ESP32)

```json
// èˆµæœºæ§åˆ¶
{
    "type": "servo",
    "x": 90,
    "y": 45
}

// TTS æ’­æ”¾ (PC å‘é€éŸ³é¢‘æ•°æ®)
{
    "type": "tts",
    "format": "opus",
    "data": "<base64 encoded opus>"
}

// æ–‡å­—æ˜¾ç¤º
{
    "type": "display",
    "text": "ä½ å¥½",
    "size": 24
}

// æ‹ç…§è¯·æ±‚
{
    "type": "capture",
    "quality": 80
}
```

#### 3.1.3 åª’ä½“æµ (ESP32 â†’ PC)

```json
// éŸ³é¢‘æµ
{
    "type": "audio",
    "format": "opus",
    "sample_rate": 16000,
    "data": "<base64 encoded opus>"
}

// è§†é¢‘æµ (JPEG)
{
    "type": "video",
    "format": "jpeg",
    "width": 412,
    "height": 412,
    "data": "<base64 encoded jpeg>"
}

// ä¼ æ„Ÿå™¨æ•°æ®
{
    "type": "sensor",
    "co2": 400,
    "temperature": 25.5,
    "humidity": 60
}
```

### 3.2 è¿æ¥æµç¨‹

```
PC Server                              ESP32 Client
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. å¯åŠ¨æœåŠ¡å™¨                            1. WiFi è¿æ¥
   ç›‘å¬ :8766
                                          2. WebSocket è¿æ¥
2. æ¥å—è¿æ¥        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    ws://PC_IP:8766
3. å‘é€é…ç½®        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   {"type": "config", "sample_rate": 16000}

4. åŒå‘åª’ä½“æµä¼ è¾“ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   (æŒç»­)

5. æ§åˆ¶æŒ‡ä»¤       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   {"type": "servo", "x": 90}
```

---

## å››ã€åŠŸèƒ½æ¨¡å—

### 4.1 éŸ³é¢‘æ¨¡å— (ESP32)

#### 4.1.1 éŸ³é¢‘é‡‡é›†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  I2S éº¦å…‹é£  â”‚ â”€â”€â–º â”‚  PCM ç¼“å­˜   â”‚ â”€â”€â–º â”‚  Opus ç¼–ç   â”‚
â”‚  (16kHz)    â”‚     â”‚  (60mså¸§)   â”‚     â”‚  (60mså¸§)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ WebSocket   â”‚
                                      â”‚   å‘é€      â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.2 éŸ³é¢‘æ’­æ”¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WebSocket   â”‚ â”€â”€â–º â”‚  Opus è§£ç   â”‚ â”€â”€â–º â”‚  I2S å–‡å­   â”‚
â”‚   æ¥æ”¶      â”‚     â”‚             â”‚     â”‚  (16kHz)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.3 å‚æ•°é…ç½®

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| é‡‡æ ·ç‡ | 16000 Hz | é€‚åˆè¯­éŸ³ |
| å¸§é•¿ | 60 ms | Opus æ¨è |
| ç¼–ç  | Opus | ä½å¸¦å®½ |
| æ¯”ç‰¹ç‡ | 16-32 kbps | å¯è°ƒ |

### 4.2 è§†é¢‘æ¨¡å— (ESP32)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Himax æ‘„åƒ  â”‚ â”€â”€â–º â”‚  JPEG ç¼–ç   â”‚ â”€â”€â–º â”‚ WebSocket   â”‚
â”‚ 412x412     â”‚     â”‚             â”‚     â”‚   å‘é€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| åˆ†è¾¨ç‡ | 412x412 | Himax æœ€å¤§ |
| æ ¼å¼ | JPEG | å‹ç¼©ä¼ è¾“ |
| å¸§ç‡ | ~5 fps | å—é™äºä¼ è¾“å¸¦å®½ |

### 4.3 è¿åŠ¨æ§åˆ¶æ¨¡å— (ESP32)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WebSocket   â”‚ â”€â”€â–º â”‚  æŒ‡ä»¤è§£æ   â”‚ â”€â”€â–º â”‚  LEDC PWM  â”‚
â”‚   æ¥æ”¶      â”‚     â”‚  X/Y è§’åº¦   â”‚     â”‚  èˆµæœºæ§åˆ¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```c
// èˆµæœºå‚æ•°
#define SERVO_FREQ     50      // 50Hz (20mså‘¨æœŸ)
#define SERVO_RES      13       // 13ä½åˆ†è¾¨ç‡
#define SERVO_MIN_US   500      // 0.5ms = 0Â°
#define SERVO_MAX_US   2500     // 2.5ms = 180Â°

// è§’åº¦åˆ° PWM è½¬æ¢
uint32_t angle_to_duty(int angle) {
    // angle: 0-180
    // return: duty (0-8191)
    return SERVO_MIN_US + (angle * (SERVO_MAX_US - SERVO_MIN_US) / 180);
}
```

### 4.4 äº‘ç«¯æ¨¡å— (Python)

#### 4.4.1 WebSocket æœåŠ¡å™¨

```python
class WatcherServer:
    def __init__(self, host='0.0.0.0', port=8766):
        self.clients = set()

    async def handle_websocket(self, websocket):
        self.clients.add(websocket)
        try:
            async for message in websocket:
                await self.process_message(message)
        finally:
            self.clients.remove(websocket)

    async def process_message(self, message):
        data = json.loads(message)
        msg_type = data.get('type')

        if msg_type == 'audio':
            await self.handle_audio(data)
        elif msg_type == 'video':
            await self.handle_video(data)
        elif msg_type == 'servo':
            await self.handle_servo(data)
```

#### 4.4.2 LLM Agent é›†æˆ

```python
class Agent:
    def __init__(self, llm_provider='claude'):
        self.llm = LLMProvider(llm_provider)
        self.tools = self.register_tools()

    async def process(self, audio_data):
        # 1. ASR (è¯­éŸ³è½¬æ–‡å­—)
        text = await self.asr.transcribe(audio_data)

        # 2. Agent æ¨ç†
        response = await self.llm.chat(
            messages=[{"role": "user", "content": text}],
            tools=self.tools
        )

        # 3. æ‰§è¡ŒåŠ¨ä½œ
        for tool_call in response.tool_calls:
            await self.execute_tool(tool_call)

        # 4. TTS (æ–‡å­—è½¬è¯­éŸ³)
        if response.should_speak:
            audio = await self.tts.synthesize(response.text)
            await self.send_to_esp32(audio, 'tts')
```

---

## äº”ã€å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€é€šä¿¡ (1 å‘¨)

- [ ] ESP32 WebSocket å®¢æˆ·ç«¯
- [ ] PC WebSocket æœåŠ¡å™¨
- [ ] åŒå‘æ–‡æœ¬æ¶ˆæ¯é€šä¿¡
- [ ] è¿æ¥çŠ¶æ€ç®¡ç†

### Phase 2: éŸ³é¢‘é€šè·¯ (1 å‘¨)

- [ ] ESP32 I2S éº¦å…‹é£é‡‡é›†
- [ ] ESP32 Opus ç¼–ç 
- [ ] PC ç«¯ Opus è§£ç 
- [ ] PC ç«¯éŸ³é¢‘å½•åˆ¶æµ‹è¯•

### Phase 3: äº‘ç«¯ AI é›†æˆ (1 å‘¨)

- [ ] Python ASR æ¥å£ (Whisper ç­‰)
- [ ] Python LLM æ¥å£ (Claude/OpenAI)
- [ ] Agent é€»è¾‘
- [ ] TTS æ¥å£

### Phase 4: æ§åˆ¶é—­ç¯ (1 å‘¨)

- [ ] èˆµæœºæ§åˆ¶æŒ‡ä»¤
- [ ] TTS æ’­æ”¾é€šè·¯
- [ ] è§†é¢‘é‡‡é›† (å¯é€‰)
- [ ] æ•´ä½“è”è°ƒ

---

## å…­ã€å…³é”®æ–‡ä»¶

| æ¨¡å— | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| ESP32 å…¥å£ | `firmware/main/app_main.c` | ç³»ç»Ÿåˆå§‹åŒ– |
| WS å®¢æˆ·ç«¯ | `firmware/main/ws_client.c` | é€šä¿¡æ ¸å¿ƒ |
| éŸ³é¢‘ pipeline | `firmware/main/audio_pipeline.c` | éŸ³è§†é¢‘å¤„ç† |
| èˆµæœºæ§åˆ¶ | `firmware/main/servo_control.c` | è¿åŠ¨æ§åˆ¶ |
| PC æœåŠ¡å™¨ | `server/websocket_server.py` | äº‘ç«¯å…¥å£ |
| Agent | `server/ai/agent.py` | AI é€»è¾‘ |

---

## ä¸ƒã€é…ç½®è¯´æ˜

### 7.1 ESP32 é…ç½®

```c
// wifi_config.h
#define WIFI_SSID "YourSSID"
#define WIFI_PASSWORD "YourPassword"
#define WS_SERVER_URL "ws://192.168.1.100:8766"
```

### 7.2 PC é…ç½®

```python
# config.py
class Config:
    WS_HOST = "0.0.0.0"
    WS_PORT = 8766

    # LLM é…ç½®
    LLM_PROVIDER = "claude"  # æˆ– "openai"
    LLM_API_KEY = "sk-..."

    # ASR é…ç½® (å¯é€‰)
    ASR_PROVIDER = "whisper"

    # TTS é…ç½® (å¯é€‰)
    TTS_PROVIDER = "elevenlabs"
```

---

## å…«ã€æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œè¦æ±‚**: ESP32 å’Œ PC éœ€è¦åœ¨åŒä¸€å±€åŸŸç½‘
2. **å»¶è¿Ÿ**: WebSocket ä¼ è¾“æœ‰ 100-200ms å»¶è¿Ÿ
3. **å¸¦å®½**: éŸ³é¢‘ ~16kbps, è§†é¢‘ ~100kbps
4. **å®‰å…¨**: ç”Ÿäº§ç¯å¢ƒéœ€è¦ TLS åŠ å¯†

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*
*åˆ›å»ºæ—¥æœŸ: 2026-02-26*
