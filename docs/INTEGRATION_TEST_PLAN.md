# MVP-W 联调测试计划

> 创建日期：2026-03-01
> 状态：客户端已适配，待联调

## 1. 协议对齐状态

### 1.1 音频流协议 ✅ 已对齐

| 功能 | 服务器 | 客户端 | 状态 |
|------|--------|--------|------|
| 音频上传 | Raw PCM | Raw PCM | ✅ |
| 录音结束 | `"over"` | `"over"` | ✅ |
| ASR 结果 | `"result: {text}"` | 解析 `"result:"` | ✅ |
| TTS 开始 | `"tts:start"` | 处理 `"tts:start"` | ✅ |
| TTS 音频 | Raw PCM | Raw PCM | ✅ |
| 错误消息 | `"error: {msg}"` | 处理 `"error:"` | ✅ |

### 1.2 待确认

| 项目 | 客户端 | 服务器 | 需确认 |
|------|--------|--------|--------|
| 端口 | 8766 | 默认 8765 | 改服务器为 8766 |
| IP | 192.168.31.10 | - | 确认服务器在此 IP |

---

## 2. 测试用例

### 2.1 连接测试

| # | 测试项 | 预期结果 | 状态 |
|---|--------|---------|------|
| 1.1 | ESP32-S3 连接 WebSocket | 日志 "WebSocket connected" | ⬜ |
| 1.2 | 屏幕显示 happy 表情 | 连接成功后显示 | ⬜ |

### 2.2 音频上传测试

| # | 测试项 | 预期结果 | 状态 |
|---|--------|---------|------|
| 2.1 | 长按按钮录音 | 屏幕显示 "Listening..." | ⬜ |
| 2.2 | 发送 Raw PCM | 服务器收到音频数据 | ⬜ |
| 2.3 | 松开按钮 | 发送 `"over"` | ⬜ |

### 2.3 ASR + TTS 测试

| # | 测试项 | 预期结果 | 状态 |
|---|--------|---------|------|
| 3.1 | 收到 ASR 结果 | `"result: xxx"` → 显示文字 | ⬜ |
| 3.2 | 收到 `"tts:start"` | 显示 speaking 表情 | ⬜ |
| 3.3 | 收到 TTS 音频 | 播放 Raw PCM | ⬜ |

---

## 3. 服务器配置清单

修改 `watcher-server/.env`:

```bash
WS_PORT=8766
```

---

## 4. 联调环境

| 项目 | 配置 |
|------|------|
| 服务器 IP | `192.168.31.10` |
| 服务器端口 | `8766` |
| ESP32-S3 端口 | `COM3` |
| ESP32-MCU 端口 | `COM4` |

---

*文档版本：1.2*
*更新日期：2026-03-01*
